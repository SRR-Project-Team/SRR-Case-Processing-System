{"ast":null,"code":"var _jsxFileName = \"D:\\\\SRR-Case-Processing-System\\\\frontend\\\\srr-chatbot\\\\src\\\\components\\\\ChatbotInterface.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport { Send, Upload, FileText } from 'lucide-react';\nimport { processFile, processMultipleFiles, queryCase, findSimilarCases, getCaseStatistics } from '../services/api';\nimport logoImage from '../images/system_logo.png';\nimport universityLogo from '../images/university_logo.png';\nimport FileUploadModal from './FileUploadModal';\nimport FileInfoModal from './FileInfoModal';\nimport botIcon from '../images/bot_icon.jpeg';\nimport userIcon from '../images/user_icon.jpeg';\nimport sidebarbutton from '../images/sidebar_button.png';\nimport './ChatbotInterface.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ChatbotInterface = () => {\n  _s();\n  const [chatState, setChatState] = useState({\n    messages: [{\n      id: '1',\n      type: 'bot',\n      content: 'Hello! I am the SRR case processing assistant. Please upload PDF or TXT files (supports multi-file batch processing), and I will extract case information and answer related questions for you.',\n      timestamp: new Date()\n    }],\n    isLoading: false,\n    extractedData: null,\n    currentFile: null\n  });\n  const [inputMessage, setInputMessage] = useState('');\n  const [selectedFiles, setSelectedFiles] = useState([]);\n  // Ensure each message has a unique, stable ID for React list keys\n  const messageIdRef = useRef(2); // start after initial message with id '1'\n  const messagesEndRef = useRef(null);\n  const [summaryResult, setSummaryResult] = useState(null);\n  const [isUploadModalOpen, setIsUploadModalOpen] = useState(false);\n  const [isFileInfoModalOpen, setIsFileInfoModalOpen] = useState(false);\n  // å®šä¹‰ä¾§è¾¹æ çŠ¶æ€\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n  const [userLogin, setUserLogin] = useState(false);\n\n  // åˆ‡æ¢ä¾§è¾¹æ çŠ¶æ€\n  const toggleSidebar = () => {\n    setIsSidebarOpen(!isSidebarOpen);\n  };\n\n  // Auto scroll to latest message\n  const scrollToBottom = () => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  };\n  useEffect(() => {\n    scrollToBottom();\n  }, [chatState.messages]);\n\n  // Add message\n  const addMessage = (type, content, fileInfo) => {\n    const newMessage = {\n      id: (messageIdRef.current++).toString(),\n      type,\n      content,\n      timestamp: new Date(),\n      fileInfo\n    };\n    setChatState(prev => ({\n      ...prev,\n      messages: [...prev.messages, newMessage]\n    }));\n  };\n\n  // Handle file selection (not immediate processing, just file selection)\n  const handleFileSelection = files => {\n    if (files.length === 0) return;\n\n    // Validate file types and sizes\n    const allowedTypes = ['text/plain', 'application/pdf', 'application/vnd.ms-excel',\n    // .xls\n    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' // .xlsx\n    ];\n    const maxSize = 10 * 1024 * 1024; // 10MB limit\n\n    const invalidFiles = files.filter(file => !allowedTypes.includes(file.type) || file.size > maxSize);\n    if (invalidFiles.length > 0) {\n      const errorMsg = invalidFiles.map(file => {\n        if (!allowedTypes.includes(file.type)) {\n          return `${file.name}: Unsupported file type`;\n        }\n        if (file.size > maxSize) {\n          return `${file.name}: File size exceeds 10MB limit`;\n        }\n        return `${file.name}: Unknown error`;\n      }).join('\\n');\n      addMessage('bot', `The following files cannot be processed:\\n${errorMsg}\\n\\nOnly TXT, PDF, XLS, and XLSX files are supported, with a maximum file size of 10MB.`);\n\n      // Filter out invalid files\n      const validFiles = files.filter(file => allowedTypes.includes(file.type) && file.size <= maxSize);\n      if (validFiles.length === 0) return;\n      files = validFiles;\n    }\n\n    // Add to existing file list (avoid duplicates)\n    const newFiles = files.filter(newFile => !selectedFiles.some(existingFile => existingFile.name === newFile.name && existingFile.size === newFile.size));\n    if (newFiles.length === 0) {\n      addMessage('bot', 'Selected files already exist in the list.');\n      return;\n    }\n    setSelectedFiles(prev => [...prev, ...newFiles]);\n\n    // Display file selection message in chat\n    if (newFiles.length === 1) {\n      addMessage('user', `ğŸ“ Added file: ${newFiles[0].name}`, {\n        name: newFiles[0].name,\n        size: newFiles[0].size,\n        type: newFiles[0].type\n      });\n    } else {\n      const fileNames = newFiles.map(f => f.name).join(', ');\n      addMessage('user', `ğŸ“ Added ${newFiles.length} files: ${fileNames}`);\n    }\n\n    // Display current total file count\n    const totalFiles = selectedFiles.length + newFiles.length;\n    addMessage('bot', `âœ… Files added successfully! Total: ${totalFiles} file${totalFiles > 1 ? 's' : ''}.\\n\\nClick the \"ğŸ“ Upload Files\" button to view and manage your files, or click \"Process Files\" to start processing.`);\n  };\n  const handleRemoveFile = index => {\n    const newFiles = selectedFiles.filter((_, i) => i !== index);\n    setSelectedFiles(newFiles);\n    if (newFiles.length === 0) {\n      addMessage('bot', 'All files removed from selection.');\n    } else {\n      addMessage('bot', `File removed. ${newFiles.length} file${newFiles.length > 1 ? 's' : ''} remaining.`);\n    }\n  };\n  const handleClearAllFiles = () => {\n    setSelectedFiles([]);\n    addMessage('bot', 'All files cleared from selection.');\n  };\n\n  // Handle file upload (actual processing of selected files)\n  const handleFileUpload = async () => {\n    setIsUploadModalOpen(false);\n    const files = selectedFiles;\n    if (files.length === 0) {\n      addMessage('bot', 'Please select files to process first.');\n      return;\n    }\n\n    // Single file processing\n    if (files.length === 1) {\n      const file = files[0];\n      const fileInfo = {\n        name: file.name,\n        size: file.size,\n        type: file.type\n      };\n      addMessage('user', `Upload file: ${file.name}`, fileInfo);\n\n      // Provide different processing hints based on file type\n      let processingMessage = 'Processing your file, please wait...';\n      if (file.name.toLowerCase().startsWith('rcc') && file.type === 'application/pdf') {\n        processingMessage = 'Processing RCC PDF file, OCR recognition may take 1-2 minutes, please be patient...';\n      } else if (file.type === 'application/pdf') {\n        processingMessage = 'Processing PDF file, please wait...';\n      }\n      addMessage('bot', processingMessage);\n      setChatState(prev => ({\n        ...prev,\n        isLoading: true,\n        currentFile: fileInfo\n      }));\n      try {\n        const result = await processFile(file);\n        if (result.status === 'success' && result.data) {\n          setChatState(prev => ({\n            ...prev,\n            isLoading: false,\n            extractedData: result.data,\n            rawFileContent: result.raw_content\n          }));\n\n          // Display extracted case data in chat\n          const caseData = result.data;\n          addMessage('bot', `âœ… **File Processing Successful!**\n\nğŸ“‹ **Extracted Case Information:**\n\nğŸ“… **Date Received:** ${caseData.A_date_received || 'N/A'}\nğŸ“‹ **Source:** ${caseData.B_source || 'N/A'}\nğŸ”¢ **Case Number:** ${caseData.C_case_number || 'N/A'}\nâš¡ **Type:** ${caseData.D_type || 'N/A'}\nğŸ‘¤ **Caller:** ${caseData.E_caller_name || 'N/A'}\nğŸ“ **Contact:** ${caseData.F_contact_no || 'N/A'}\nğŸ—ï¸ **Slope Number:** ${caseData.G_slope_no || 'N/A'}\nğŸ“ **Location:** ${caseData.H_location || 'N/A'}\nğŸ“ **Nature of Request:** ${caseData.I_nature_of_request || 'N/A'}\nğŸ·ï¸ **Subject Matter:** ${caseData.J_subject_matter || 'N/A'}\nâ° **10-day Due:** ${caseData.K_10day_rule_due_date || 'N/A'}\nâ° **ICC Interim Due:** ${caseData.L_icc_interim_due || 'N/A'}\nâ° **ICC Final Due:** ${caseData.M_icc_final_due || 'N/A'}\n\nğŸ’¬ **You can now ask me questions about this case, such as:**\nâ€¢ \"What is the basic information of this case?\"\nâ€¢ \"Contact information\"\nâ€¢ \"Slope-related information\"\nâ€¢ \"Important dates\"\nâ€¢ \"Nature of the case\"\n\nğŸ“Š Click \"View Details\" to see complete file information and processing status.`);\n\n          // display AI summary\n          if (result.summary) {\n            setSummaryResult(result.summary);\n            if (result.summary.success && result.summary.summary) {\n              addMessage('bot', `ğŸ¤– AI Summary:\\n\\n\"${result.summary.summary}\"`, {\n                type: 'summary',\n                summary: result.summary\n              });\n            } else {\n              addMessage('bot', `âš ï¸ AI summary generation failed: ${result.summary.error || 'Unknown error'}`, {\n                type: 'summary-error'\n              });\n            }\n          }\n\n          // Auto-search for similar cases\n          try {\n            addMessage('bot', 'ğŸ” Searching for similar historical cases...');\n            const similarResult = await findSimilarCases(caseData, 5, 0.3);\n            if (similarResult.status === 'success' && similarResult.total_found > 0) {\n              const cases = similarResult.similar_cases;\n              let message = `ğŸ“š **Found ${cases.length} Similar Historical Cases:**\\n\\n`;\n              cases.forEach((item, index) => {\n                const c = item.case;\n                const score = (item.similarity_score * 100).toFixed(1);\n                const isDup = item.is_potential_duplicate ? ' ğŸ”´ **POTENTIAL DUPLICATE**' : '';\n                const source = item.data_source || 'Unknown';\n                message += `**${index + 1}. [${source}] Case #${c.C_case_number || 'N/A'}** (${score}% match)${isDup}\\n`;\n                message += `   ğŸ“… Date: ${c.A_date_received || 'N/A'}\\n`;\n                message += `   ğŸ“ Location: ${c.H_location || 'N/A'}\\n`;\n                message += `   ğŸ—ï¸ Slope: ${c.G_slope_no || 'N/A'}\\n`;\n                message += `   ğŸ“ Subject: ${c.J_subject_matter || 'N/A'}\\n`;\n\n                // Add caller information\n                if (c.E_caller_name || c.F_contact_no) {\n                  message += `   ğŸ‘¤ Caller: ${c.E_caller_name || 'N/A'}\\n`;\n                  message += `   ğŸ“ Phone: ${c.F_contact_no || 'N/A'}\\n`;\n                }\n\n                // Add tree information if available\n                if (c.tree_id || c.tree_count) {\n                  if (c.tree_id) {\n                    message += `   ğŸŒ³ Tree ID: ${c.tree_id}\\n`;\n                  }\n                  if (c.tree_count) {\n                    message += `   ğŸŒ² Number of Trees: ${c.tree_count}\\n`;\n                  }\n                }\n\n                // Add nature of request (complaint details)\n                if (c.I_nature_of_request && c.I_nature_of_request !== 'N/A' && c.I_nature_of_request.trim()) {\n                  const nature = c.I_nature_of_request.length > 150 ? c.I_nature_of_request.substring(0, 150) + '...' : c.I_nature_of_request;\n                  message += `   ğŸ“„ Complaint Details: ${nature}\\n`;\n                }\n\n                // Add inspector remarks if available\n                if (c.inspector_remarks) {\n                  message += `   ğŸ” Inspector Remarks: ${c.inspector_remarks}\\n`;\n                }\n                message += '\\n';\n              });\n              addMessage('bot', message);\n\n              // Get statistics for the location\n              if (caseData.H_location) {\n                const statsResult = await getCaseStatistics({\n                  location: caseData.H_location\n                });\n                if (statsResult.status === 'success' && statsResult.statistics) {\n                  const stats = statsResult.statistics;\n                  const isFrequent = stats.is_frequent_complaint;\n                  let statsMessage = `ğŸ“Š **Location Statistics:**\\n\\n`;\n                  statsMessage += `ğŸ“ Location: ${caseData.H_location}\\n`;\n                  statsMessage += `ğŸ“ˆ Total Cases: ${stats.total_cases}\\n`;\n                  statsMessage += `âš ï¸ Frequent Complaint: ${isFrequent ? 'YES ğŸ”´' : 'NO âœ…'}\\n\\n`;\n                  if (isFrequent) {\n                    statsMessage += `âš ï¸ **This location has received ${stats.total_cases} complaints, indicating a recurring issue that may require attention.**`;\n                  }\n                  addMessage('bot', statsMessage);\n                }\n              }\n            } else {\n              addMessage('bot', 'âœ… No similar historical cases found. This appears to be a unique case.');\n            }\n          } catch (error) {\n            console.error('Similar case search error:', error);\n            addMessage('bot', 'âš ï¸ Unable to search similar cases, but file processing was successful.');\n          }\n\n          // Clear selected file list\n          setSelectedFiles([]);\n          setIsUploadModalOpen(false);\n        } else {\n          setChatState(prev => ({\n            ...prev,\n            isLoading: false\n          }));\n          addMessage('bot', `File processing failed: ${result.message || result.error || 'Unknown error'}`);\n          // Clear file list on failure\n          setSelectedFiles([]);\n          setIsUploadModalOpen(false);\n        }\n      } catch (error) {\n        setChatState(prev => ({\n          ...prev,\n          isLoading: false\n        }));\n        addMessage('bot', `Error processing file: ${error instanceof Error ? error.message : 'Unknown error'}`);\n        // Clear file list on error\n        setSelectedFiles([]);\n        setIsUploadModalOpen(false);\n      }\n    }\n    // Multi-file batch processing\n    else {\n      const fileNames = files.map(f => f.name).join(', ');\n      addMessage('user', `Batch upload ${files.length} files: ${fileNames}`);\n      addMessage('bot', `Processing ${files.length} files in batch, please wait...\n      ${files.some(f => f.name.toLowerCase().startsWith('rcc')) ? 'âš ï¸ RCC files detected, OCR processing may take longer time.' : ''}`);\n      setChatState(prev => ({\n        ...prev,\n        isLoading: true,\n        currentFile: {\n          name: `${files.length} files`,\n          size: 0,\n          type: 'batch'\n        }\n      }));\n      try {\n        const result = await processMultipleFiles(files);\n        setChatState(prev => ({\n          ...prev,\n          isLoading: false\n        }));\n\n        // Display batch processing results - æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶çš„ç»“æœï¼ŒåŒ…æ‹¬è·³è¿‡çš„\n        const successFiles = result.results.filter(r => r.status === 'success');\n        const failedFiles = result.results.filter(r => r.status === 'error');\n        const skippedFiles = result.results.filter(r => r.status === 'skipped'); // æ–°å¢\n\n        let resultMessage = `ğŸ“Š Batch processing completed!\n\nğŸ“ˆ Processing Statistics:\nâ€¢ Total files: ${result.total_files}\nâ€¢ Successfully processed: ${result.successful}\nâ€¢ Processing failed: ${result.failed}\nâ€¢ Skipped files: ${result.skipped}`; // æ·»åŠ è·³è¿‡ç»Ÿè®¡\n\n        // æ˜¾ç¤ºæˆåŠŸæ–‡ä»¶ï¼ˆåŒ…å«è¯¦ç»†ä¿¡æ¯ï¼‰\n        if (successFiles.length > 0) {\n          resultMessage += `\\n\\nâœ… Successfully processed files (${successFiles.length}):`;\n          successFiles.forEach((f, index) => {\n            resultMessage += `\\n\\n${index + 1}. ${f.main_file}`;\n            if (f.email_file) {\n              resultMessage += ` (paired with ${f.email_file})`;\n            }\n            resultMessage += `\\n   Case ID: ${f.case_id || 'N/A'}`;\n            resultMessage += `\\n   Status: ${f.message}`;\n            if (f.structured_data) {\n              resultMessage += `\\n   ğŸ“‹ Extracted: Date=${f.structured_data.A_date_received || 'N/A'}, Case=${f.structured_data.C_case_number || 'N/A'}, Location=${f.structured_data.H_location || 'N/A'}`;\n            }\n          });\n        }\n\n        // æ˜¾ç¤ºå¤±è´¥æ–‡ä»¶\n        if (failedFiles.length > 0) {\n          resultMessage += `\\n\\nâŒ Failed to process files (${failedFiles.length}):`;\n          failedFiles.forEach((f, index) => {\n            resultMessage += `\\n${index + 1}. ${f.main_file}`;\n            resultMessage += `\\n   Case ID: ${f.case_id || 'N/A'}`;\n            resultMessage += `\\n   Error: ${f.message}`;\n          });\n        }\n\n        // æ˜¾ç¤ºè·³è¿‡çš„æ–‡ä»¶ï¼ˆæ–°å¢ï¼‰\n        if (skippedFiles.length > 0) {\n          resultMessage += `\\n\\nâ­ï¸ Skipped files (${skippedFiles.length}):`;\n          skippedFiles.forEach((f, index) => {\n            resultMessage += `\\n${index + 1}. ${f.main_file}`;\n            resultMessage += `\\n   Case ID: ${f.case_id || 'N/A'}`;\n            resultMessage += `\\n   Reason: ${f.message}`;\n          });\n        }\n        if (successFiles.length > 0) {\n          resultMessage += `\\n\\nğŸ’¡ Note: The right information panel shows the last successfully processed file (${successFiles[successFiles.length - 1].main_file}).`;\n          resultMessage += `\\n   All ${successFiles.length} files have been processed successfully.`;\n          resultMessage += `\\n   You can ask questions about any of the processed cases.`;\n\n          // è®¾ç½®æœ€åä¸€ä¸ªæˆåŠŸæ–‡ä»¶çš„æ•°æ®åˆ°å³ä¾§é¢æ¿\n          const lastSuccessFile = successFiles[successFiles.length - 1];\n          if (lastSuccessFile.structured_data) {\n            setChatState(prev => ({\n              ...prev,\n              extractedData: lastSuccessFile.structured_data\n            }));\n          }\n        }\n        addMessage('bot', resultMessage);\n\n        // Clear file list after batch processing\n        setSelectedFiles([]);\n        setIsUploadModalOpen(false);\n      } catch (error) {\n        setChatState(prev => ({\n          ...prev,\n          isLoading: false\n        }));\n        addMessage('bot', `Error in batch processing files: ${error instanceof Error ? error.message : 'Unknown error'}`);\n\n        // Clear file list on error\n        setSelectedFiles([]);\n        setIsUploadModalOpen(false);\n      }\n    }\n  };\n\n  // Handle user queries\n  const handleQuery = async () => {\n    if (!inputMessage.trim()) return;\n    const userQuery = inputMessage.trim();\n    setInputMessage('');\n    addMessage('user', userQuery);\n    setChatState(prev => ({\n      ...prev,\n      isLoading: true\n    }));\n    try {\n      const response = await queryCase({\n        query: userQuery,\n        context: chatState.extractedData || undefined,\n        raw_content: chatState.rawFileContent || undefined\n      });\n      setChatState(prev => ({\n        ...prev,\n        isLoading: false\n      }));\n      addMessage('bot', response);\n    } catch (error) {\n      setChatState(prev => ({\n        ...prev,\n        isLoading: false\n      }));\n      addMessage('bot', `Query failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  };\n\n  // Note: Drag and drop functionality is now handled in FileUploadModal component\n\n  // Handle keyboard events\n  const handleKeyPress = e => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleQuery();\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chatbot-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-section-full\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-header\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"header-content\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: universityLogo,\n            alt: \"SRR Logo\",\n            className: \"header-logo\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 498,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n            src: logoImage,\n            alt: \"SRR Logo\",\n            className: \"header-logo\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 499,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"header-text\",\n            children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n              children: \"SRR Case Processing Assistant\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 501,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"Intelligent File Processing & Case Query System\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 502,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 500,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 497,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 496,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-body\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: `sidebar-logo ${!isSidebarOpen ? 'open' : ''}`,\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: sidebarbutton,\n            alt: \"SideBar\",\n            className: \"sidebar-button\",\n            onClick: toggleSidebar,\n            style: {}\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 511,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 510,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `sidebar-area ${isSidebarOpen ? 'open' : ''}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"sidebar-sideberheader\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"sidebar-userprofile\",\n              children: /*#__PURE__*/_jsxDEV(\"img\", {\n                src: \"https://picsum.photos/200/200\",\n                alt: \"Profile Picture\",\n                className: \"sidebar-profilepic\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 516,\n                columnNumber: 15\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 515,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"sidebar-sidebarclose\",\n              children: /*#__PURE__*/_jsxDEV(\"img\", {\n                src: sidebarbutton,\n                alt: \"SideBar\",\n                className: \"sidebar-button\",\n                onClick: toggleSidebar\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 519,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 518,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 514,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"sidebar-history\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 522,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 513,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-inputandoutput\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-messages\",\n            children: [chatState.messages.map(message => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `message ${message.type}`,\n              children: [message.type === 'bot' && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"message-avatar\",\n                children: /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: botIcon,\n                  alt: \"Bot\",\n                  className: \"avatar-image\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 533,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 532,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"message-content\",\n                children: [message.fileInfo && /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    marginBottom: '8px',\n                    fontSize: '12px',\n                    opacity: 0.8\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(FileText, {\n                    size: 14,\n                    style: {\n                      display: 'inline',\n                      marginRight: '4px'\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 539,\n                    columnNumber: 25\n                  }, this), message.fileInfo.name, \" (\", (message.fileInfo.size / 1024).toFixed(1), \" KB)\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 538,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    whiteSpace: 'pre-line'\n                  },\n                  children: message.content\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 546,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 536,\n                columnNumber: 19\n              }, this), message.type === 'user' && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"message-avatar\",\n                children: /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: userIcon,\n                  alt: \"User\",\n                  className: \"avatar-image\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 553,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 552,\n                columnNumber: 21\n              }, this)]\n            }, message.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 530,\n              columnNumber: 17\n            }, this)), chatState.isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"message bot\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"message-avatar\",\n                children: /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: botIcon,\n                  alt: \"Bot\",\n                  className: \"avatar-image\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 562,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 561,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"message-content\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"loading\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"loading-spinner\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 566,\n                    columnNumber: 23\n                  }, this), \"Processing...\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 565,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 564,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 560,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              ref: messagesEndRef\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 573,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 528,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-input\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input-container\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                value: inputMessage,\n                onChange: e => setInputMessage(e.target.value),\n                onKeyPress: handleKeyPress,\n                placeholder: chatState.isLoading ? \"Processing...\" : selectedFiles.length > 0 && !chatState.extractedData ? \"Click 'Process Files' to start processing or ask questions...\" : chatState.extractedData ? \"Ask questions about the case...\" : \"Type your message or upload files to get started...\",\n                disabled: chatState.isLoading\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 578,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"input-actions\",\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"action-button upload-button\",\n                  onClick: () => setIsUploadModalOpen(true),\n                  disabled: chatState.isLoading,\n                  title: \"Upload files\",\n                  children: /*#__PURE__*/_jsxDEV(Upload, {\n                    size: 18\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 603,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 597,\n                  columnNumber: 19\n                }, this), selectedFiles.length > 0 && !chatState.extractedData && /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"action-button process-button\",\n                  onClick: handleFileUpload,\n                  disabled: chatState.isLoading,\n                  title: \"Process selected files\",\n                  children: chatState.isLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"loading-spinner-small\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 615,\n                    columnNumber: 25\n                  }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                    children: [/*#__PURE__*/_jsxDEV(Upload, {\n                      size: 18\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 618,\n                      columnNumber: 27\n                    }, this), \"Process\"]\n                  }, void 0, true)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 608,\n                  columnNumber: 21\n                }, this), chatState.extractedData && /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"action-button details-button\",\n                  onClick: () => setIsFileInfoModalOpen(true),\n                  title: \"View file details\",\n                  children: /*#__PURE__*/_jsxDEV(FileText, {\n                    size: 18\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 632,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 627,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"action-button send-button\",\n                  onClick: handleQuery,\n                  disabled: !inputMessage.trim() || chatState.isLoading,\n                  title: \"Send message\",\n                  children: /*#__PURE__*/_jsxDEV(Send, {\n                    size: 18\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 643,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 637,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 595,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 577,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 576,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 527,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 507,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 495,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(FileUploadModal, {\n      isOpen: isUploadModalOpen,\n      onClose: () => setIsUploadModalOpen(false),\n      onFilesSelected: handleFileSelection,\n      selectedFiles: selectedFiles,\n      onRemoveFile: handleRemoveFile,\n      onClearAll: handleClearAllFiles,\n      onProcessFiles: handleFileUpload,\n      isLoading: chatState.isLoading\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 653,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(FileInfoModal, {\n      isOpen: isFileInfoModalOpen,\n      onClose: () => setIsFileInfoModalOpen(false),\n      fileInfo: chatState.currentFile,\n      extractedData: chatState.extractedData,\n      summaryResult: summaryResult\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 665,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 493,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatbotInterface, \"Rz5nkGIv/D75sO2n/IO9ycpQ91s=\");\n_c = ChatbotInterface;\nexport default ChatbotInterface;\nvar _c;\n$RefreshReg$(_c, \"ChatbotInterface\");","map":{"version":3,"names":["React","useState","useRef","useEffect","Send","Upload","FileText","processFile","processMultipleFiles","queryCase","findSimilarCases","getCaseStatistics","logoImage","universityLogo","FileUploadModal","FileInfoModal","botIcon","userIcon","sidebarbutton","jsxDEV","_jsxDEV","Fragment","_Fragment","ChatbotInterface","_s","chatState","setChatState","messages","id","type","content","timestamp","Date","isLoading","extractedData","currentFile","inputMessage","setInputMessage","selectedFiles","setSelectedFiles","messageIdRef","messagesEndRef","summaryResult","setSummaryResult","isUploadModalOpen","setIsUploadModalOpen","isFileInfoModalOpen","setIsFileInfoModalOpen","isSidebarOpen","setIsSidebarOpen","userLogin","setUserLogin","toggleSidebar","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","addMessage","fileInfo","newMessage","toString","prev","handleFileSelection","files","length","allowedTypes","maxSize","invalidFiles","filter","file","includes","size","errorMsg","map","name","join","validFiles","newFiles","newFile","some","existingFile","fileNames","f","totalFiles","handleRemoveFile","index","_","i","handleClearAllFiles","handleFileUpload","processingMessage","toLowerCase","startsWith","result","status","data","rawFileContent","raw_content","caseData","A_date_received","B_source","C_case_number","D_type","E_caller_name","F_contact_no","G_slope_no","H_location","I_nature_of_request","J_subject_matter","K_10day_rule_due_date","L_icc_interim_due","M_icc_final_due","summary","success","error","similarResult","total_found","cases","similar_cases","message","forEach","item","c","case","score","similarity_score","toFixed","isDup","is_potential_duplicate","source","data_source","tree_id","tree_count","trim","nature","substring","inspector_remarks","statsResult","location","statistics","stats","isFrequent","is_frequent_complaint","statsMessage","total_cases","console","Error","successFiles","results","r","failedFiles","skippedFiles","resultMessage","total_files","successful","failed","skipped","main_file","email_file","case_id","structured_data","lastSuccessFile","handleQuery","userQuery","response","query","context","undefined","handleKeyPress","e","key","shiftKey","preventDefault","className","children","src","alt","fileName","_jsxFileName","lineNumber","columnNumber","onClick","style","marginBottom","fontSize","opacity","display","marginRight","whiteSpace","ref","value","onChange","target","onKeyPress","placeholder","disabled","title","isOpen","onClose","onFilesSelected","onRemoveFile","onClearAll","onProcessFiles","_c","$RefreshReg$"],"sources":["D:/SRR-Case-Processing-System/frontend/srr-chatbot/src/components/ChatbotInterface.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { Send, Upload, FileText } from 'lucide-react';\r\nimport { Message, ChatState, FileSummary } from '../types';\r\nimport { processFile, processMultipleFiles, queryCase, findSimilarCases, getCaseStatistics, BatchProcessingResponse } from '../services/api';\r\nimport logoImage from '../images/system_logo.png'; \r\nimport universityLogo from '../images/university_logo.png';\r\nimport FileUploadModal from './FileUploadModal';\r\nimport FileInfoModal from './FileInfoModal';\r\nimport botIcon from '../images/bot_icon.jpeg';  \r\nimport userIcon from '../images/user_icon.jpeg';  \r\nimport sidebarbutton from '../images/sidebar_button.png';  \r\nimport './ChatbotInterface.css';\r\n\r\n\r\nconst ChatbotInterface: React.FC = () => {\r\n  const [chatState, setChatState] = useState<ChatState>({\r\n    messages: [\r\n      {\r\n        id: '1',\r\n        type: 'bot',\r\n        content: 'Hello! I am the SRR case processing assistant. Please upload PDF or TXT files (supports multi-file batch processing), and I will extract case information and answer related questions for you.',\r\n        timestamp: new Date(),\r\n      }\r\n    ],\r\n    isLoading: false,\r\n    extractedData: null,\r\n    currentFile: null,\r\n  });\r\n\r\n  const [inputMessage, setInputMessage] = useState('');\r\n  const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\r\n  // Ensure each message has a unique, stable ID for React list keys\r\n  const messageIdRef = useRef<number>(2); // start after initial message with id '1'\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const [summaryResult, setSummaryResult] = useState<FileSummary | null>(null);\r\n  const [isUploadModalOpen, setIsUploadModalOpen] = useState(false);\r\n  const [isFileInfoModalOpen, setIsFileInfoModalOpen] = useState(false);\r\n  // å®šä¹‰ä¾§è¾¹æ çŠ¶æ€\r\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\r\n  const [userLogin, setUserLogin] = useState(false);\r\n\r\n  // åˆ‡æ¢ä¾§è¾¹æ çŠ¶æ€\r\n  const toggleSidebar = () => {\r\n    setIsSidebarOpen(!isSidebarOpen);\r\n  };\r\n\r\n\r\n  // Auto scroll to latest message\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [chatState.messages]);\r\n\r\n  // Add message\r\n  const addMessage = (type: 'user' | 'bot', content: string, fileInfo?: any) => {\r\n    const newMessage: Message = {\r\n      id: (messageIdRef.current++).toString(),\r\n      type,\r\n      content,\r\n      timestamp: new Date(),\r\n      fileInfo,\r\n    };\r\n\r\n    setChatState(prev => ({\r\n      ...prev,\r\n      messages: [...prev.messages, newMessage],\r\n    }));\r\n  };\r\n\r\n  // Handle file selection (not immediate processing, just file selection)\r\n  const handleFileSelection = (files: File[]) => {\r\n    if (files.length === 0) return;\r\n\r\n    // Validate file types and sizes\r\n    const allowedTypes = ['text/plain', \r\n                          'application/pdf',\r\n                          'application/vnd.ms-excel', // .xls\r\n                          'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' // .xlsx\r\n                         ];\r\n    const maxSize = 10 * 1024 * 1024; // 10MB limit\r\n    \r\n    const invalidFiles = files.filter(file => \r\n      !allowedTypes.includes(file.type) || file.size > maxSize\r\n    );\r\n    \r\n    if (invalidFiles.length > 0) {\r\n      const errorMsg = invalidFiles.map(file => {\r\n        if (!allowedTypes.includes(file.type)) {\r\n          return `${file.name}: Unsupported file type`;\r\n        }\r\n        if (file.size > maxSize) {\r\n          return `${file.name}: File size exceeds 10MB limit`;\r\n        }\r\n        return `${file.name}: Unknown error`;\r\n      }).join('\\n');\r\n      \r\n      addMessage('bot', `The following files cannot be processed:\\n${errorMsg}\\n\\nOnly TXT, PDF, XLS, and XLSX files are supported, with a maximum file size of 10MB.`);\r\n      \r\n      // Filter out invalid files\r\n      const validFiles = files.filter(file => \r\n        allowedTypes.includes(file.type) && file.size <= maxSize\r\n      );\r\n      \r\n      if (validFiles.length === 0) return;\r\n      files = validFiles;\r\n    }\r\n\r\n    // Add to existing file list (avoid duplicates)\r\n    const newFiles = files.filter(newFile => \r\n      !selectedFiles.some(existingFile => \r\n        existingFile.name === newFile.name && existingFile.size === newFile.size\r\n      )\r\n    );\r\n    \r\n    if (newFiles.length === 0) {\r\n      addMessage('bot', 'Selected files already exist in the list.');\r\n      return;\r\n    }\r\n    \r\n    setSelectedFiles(prev => [...prev, ...newFiles]);\r\n    \r\n    // Display file selection message in chat\r\n    if (newFiles.length === 1) {\r\n      addMessage('user', `ğŸ“ Added file: ${newFiles[0].name}`, {\r\n        name: newFiles[0].name,\r\n        size: newFiles[0].size,\r\n        type: newFiles[0].type,\r\n      });\r\n    } else {\r\n      const fileNames = newFiles.map(f => f.name).join(', ');\r\n      addMessage('user', `ğŸ“ Added ${newFiles.length} files: ${fileNames}`);\r\n    }\r\n    \r\n    // Display current total file count\r\n    const totalFiles = selectedFiles.length + newFiles.length;\r\n    addMessage('bot', `âœ… Files added successfully! Total: ${totalFiles} file${totalFiles > 1 ? 's' : ''}.\\n\\nClick the \"ğŸ“ Upload Files\" button to view and manage your files, or click \"Process Files\" to start processing.`);\r\n  };\r\n\r\n  const handleRemoveFile = (index: number) => {\r\n    const newFiles = selectedFiles.filter((_, i) => i !== index);\r\n    setSelectedFiles(newFiles);\r\n    if (newFiles.length === 0) {\r\n      addMessage('bot', 'All files removed from selection.');\r\n    } else {\r\n      addMessage('bot', `File removed. ${newFiles.length} file${newFiles.length > 1 ? 's' : ''} remaining.`);\r\n    }\r\n  };\r\n\r\n  const handleClearAllFiles = () => {\r\n    setSelectedFiles([]);\r\n    addMessage('bot', 'All files cleared from selection.');\r\n  };\r\n\r\n  // Handle file upload (actual processing of selected files)\r\n  const handleFileUpload = async () => {\r\n    setIsUploadModalOpen(false);\r\n    const files = selectedFiles;\r\n    if (files.length === 0) {\r\n      addMessage('bot', 'Please select files to process first.');\r\n      return;\r\n    }\r\n\r\n    // Single file processing\r\n    if (files.length === 1) {\r\n      const file = files[0];\r\n      const fileInfo = {\r\n        name: file.name,\r\n        size: file.size,\r\n        type: file.type,\r\n      };\r\n\r\n      addMessage('user', `Upload file: ${file.name}`, fileInfo);\r\n\r\n      // Provide different processing hints based on file type\r\n      let processingMessage = 'Processing your file, please wait...';\r\n      if (file.name.toLowerCase().startsWith('rcc') && file.type === 'application/pdf') {\r\n        processingMessage = 'Processing RCC PDF file, OCR recognition may take 1-2 minutes, please be patient...';\r\n      } else if (file.type === 'application/pdf') {\r\n        processingMessage = 'Processing PDF file, please wait...';\r\n      }\r\n      addMessage('bot', processingMessage);\r\n\r\n      setChatState(prev => ({\r\n        ...prev,\r\n        isLoading: true,\r\n        currentFile: fileInfo,\r\n      }));\r\n\r\n      try {\r\n        const result = await processFile(file);\r\n        \r\n        if (result.status === 'success' && result.data) {\r\n          setChatState(prev => ({\r\n            ...prev,\r\n            isLoading: false,\r\n            extractedData: result.data!,\r\n            rawFileContent: result.raw_content,\r\n          }));\r\n\r\n          // Display extracted case data in chat\r\n          const caseData = result.data;\r\n          addMessage('bot', `âœ… **File Processing Successful!**\r\n\r\nğŸ“‹ **Extracted Case Information:**\r\n\r\nğŸ“… **Date Received:** ${caseData.A_date_received || 'N/A'}\r\nğŸ“‹ **Source:** ${caseData.B_source || 'N/A'}\r\nğŸ”¢ **Case Number:** ${caseData.C_case_number || 'N/A'}\r\nâš¡ **Type:** ${caseData.D_type || 'N/A'}\r\nğŸ‘¤ **Caller:** ${caseData.E_caller_name || 'N/A'}\r\nğŸ“ **Contact:** ${caseData.F_contact_no || 'N/A'}\r\nğŸ—ï¸ **Slope Number:** ${caseData.G_slope_no || 'N/A'}\r\nğŸ“ **Location:** ${caseData.H_location || 'N/A'}\r\nğŸ“ **Nature of Request:** ${caseData.I_nature_of_request || 'N/A'}\r\nğŸ·ï¸ **Subject Matter:** ${caseData.J_subject_matter || 'N/A'}\r\nâ° **10-day Due:** ${caseData.K_10day_rule_due_date || 'N/A'}\r\nâ° **ICC Interim Due:** ${caseData.L_icc_interim_due || 'N/A'}\r\nâ° **ICC Final Due:** ${caseData.M_icc_final_due || 'N/A'}\r\n\r\nğŸ’¬ **You can now ask me questions about this case, such as:**\r\nâ€¢ \"What is the basic information of this case?\"\r\nâ€¢ \"Contact information\"\r\nâ€¢ \"Slope-related information\"\r\nâ€¢ \"Important dates\"\r\nâ€¢ \"Nature of the case\"\r\n\r\nğŸ“Š Click \"View Details\" to see complete file information and processing status.`);\r\n          \r\n\r\n          // display AI summary\r\n        if (result.summary) {\r\n          setSummaryResult(result.summary);\r\n          \r\n          if (result.summary.success && result.summary.summary) {\r\n            addMessage('bot', `ğŸ¤– AI Summary:\\n\\n\"${result.summary.summary}\"`, {\r\n              type: 'summary',\r\n              summary: result.summary\r\n            });\r\n          } else {\r\n            addMessage('bot', `âš ï¸ AI summary generation failed: ${result.summary.error || 'Unknown error'}`, {\r\n              type: 'summary-error'\r\n            });\r\n          }\r\n        }\r\n\r\n          // Auto-search for similar cases\r\n          try {\r\n            addMessage('bot', 'ğŸ” Searching for similar historical cases...');\r\n            const similarResult = await findSimilarCases(caseData, 5, 0.3);\r\n            \r\n            if (similarResult.status === 'success' && similarResult.total_found > 0) {\r\n              const cases = similarResult.similar_cases;\r\n              let message = `ğŸ“š **Found ${cases.length} Similar Historical Cases:**\\n\\n`;\r\n              \r\n              cases.forEach((item: any, index: number) => {\r\n                const c = item.case;\r\n                const score = (item.similarity_score * 100).toFixed(1);\r\n                const isDup = item.is_potential_duplicate ? ' ğŸ”´ **POTENTIAL DUPLICATE**' : '';\r\n                const source = item.data_source || 'Unknown';\r\n                \r\n                message += `**${index + 1}. [${source}] Case #${c.C_case_number || 'N/A'}** (${score}% match)${isDup}\\n`;\r\n                message += `   ğŸ“… Date: ${c.A_date_received || 'N/A'}\\n`;\r\n                message += `   ğŸ“ Location: ${c.H_location || 'N/A'}\\n`;\r\n                message += `   ğŸ—ï¸ Slope: ${c.G_slope_no || 'N/A'}\\n`;\r\n                message += `   ğŸ“ Subject: ${c.J_subject_matter || 'N/A'}\\n`;\r\n                \r\n                // Add caller information\r\n                if (c.E_caller_name || c.F_contact_no) {\r\n                  message += `   ğŸ‘¤ Caller: ${c.E_caller_name || 'N/A'}\\n`;\r\n                  message += `   ğŸ“ Phone: ${c.F_contact_no || 'N/A'}\\n`;\r\n                }\r\n                \r\n                // Add tree information if available\r\n                if (c.tree_id || c.tree_count) {\r\n                  if (c.tree_id) {\r\n                    message += `   ğŸŒ³ Tree ID: ${c.tree_id}\\n`;\r\n                  }\r\n                  if (c.tree_count) {\r\n                    message += `   ğŸŒ² Number of Trees: ${c.tree_count}\\n`;\r\n                  }\r\n                }\r\n                \r\n                // Add nature of request (complaint details)\r\n                if (c.I_nature_of_request && c.I_nature_of_request !== 'N/A' && c.I_nature_of_request.trim()) {\r\n                  const nature = c.I_nature_of_request.length > 150 \r\n                    ? c.I_nature_of_request.substring(0, 150) + '...' \r\n                    : c.I_nature_of_request;\r\n                  message += `   ğŸ“„ Complaint Details: ${nature}\\n`;\r\n                }\r\n                \r\n                // Add inspector remarks if available\r\n                if (c.inspector_remarks) {\r\n                  message += `   ğŸ” Inspector Remarks: ${c.inspector_remarks}\\n`;\r\n                }\r\n                \r\n                message += '\\n';\r\n              });\r\n              \r\n              addMessage('bot', message);\r\n              \r\n              // Get statistics for the location\r\n              if (caseData.H_location) {\r\n                const statsResult = await getCaseStatistics({ location: caseData.H_location });\r\n                if (statsResult.status === 'success' && statsResult.statistics) {\r\n                  const stats = statsResult.statistics;\r\n                  const isFrequent = stats.is_frequent_complaint;\r\n                  \r\n                  let statsMessage = `ğŸ“Š **Location Statistics:**\\n\\n`;\r\n                  statsMessage += `ğŸ“ Location: ${caseData.H_location}\\n`;\r\n                  statsMessage += `ğŸ“ˆ Total Cases: ${stats.total_cases}\\n`;\r\n                  statsMessage += `âš ï¸ Frequent Complaint: ${isFrequent ? 'YES ğŸ”´' : 'NO âœ…'}\\n\\n`;\r\n                  \r\n                  if (isFrequent) {\r\n                    statsMessage += `âš ï¸ **This location has received ${stats.total_cases} complaints, indicating a recurring issue that may require attention.**`;\r\n                  }\r\n                  \r\n                  addMessage('bot', statsMessage);\r\n                }\r\n              }\r\n            } else {\r\n              addMessage('bot', 'âœ… No similar historical cases found. This appears to be a unique case.');\r\n            }\r\n          } catch (error) {\r\n            console.error('Similar case search error:', error);\r\n            addMessage('bot', 'âš ï¸ Unable to search similar cases, but file processing was successful.');\r\n          }\r\n\r\n          // Clear selected file list\r\n          setSelectedFiles([]);\r\n          setIsUploadModalOpen(false);\r\n        } else {\r\n          setChatState(prev => ({ ...prev, isLoading: false }));\r\n          addMessage('bot', `File processing failed: ${result.message || result.error || 'Unknown error'}`);\r\n          // Clear file list on failure\r\n          setSelectedFiles([]);\r\n          setIsUploadModalOpen(false);\r\n        }\r\n      } catch (error) {\r\n        setChatState(prev => ({ ...prev, isLoading: false }));\r\n        addMessage('bot', `Error processing file: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n        // Clear file list on error\r\n        setSelectedFiles([]);\r\n        setIsUploadModalOpen(false);\r\n      }\r\n    } \r\n    // Multi-file batch processing\r\n    else {\r\n      const fileNames = files.map(f => f.name).join(', ');\r\n      addMessage('user', `Batch upload ${files.length} files: ${fileNames}`);\r\n      \r\n      addMessage('bot', `Processing ${files.length} files in batch, please wait...\r\n      ${files.some(f => f.name.toLowerCase().startsWith('rcc')) ? \r\n      'âš ï¸ RCC files detected, OCR processing may take longer time.' : ''}`);\r\n\r\n      setChatState(prev => ({\r\n        ...prev,\r\n        isLoading: true,\r\n        currentFile: { name: `${files.length} files`, size: 0, type: 'batch' },\r\n      }));\r\n\r\n      try {\r\n        const result: BatchProcessingResponse = await processMultipleFiles(files);\r\n        \r\n        setChatState(prev => ({\r\n          ...prev,\r\n          isLoading: false,\r\n        }));\r\n\r\n        // Display batch processing results - æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶çš„ç»“æœï¼ŒåŒ…æ‹¬è·³è¿‡çš„\r\n        const successFiles = result.results.filter(r => r.status === 'success');\r\n        const failedFiles = result.results.filter(r => r.status === 'error');\r\n        const skippedFiles = result.results.filter(r => r.status === 'skipped');  // æ–°å¢\r\n        \r\n        let resultMessage = `ğŸ“Š Batch processing completed!\r\n\r\nğŸ“ˆ Processing Statistics:\r\nâ€¢ Total files: ${result.total_files}\r\nâ€¢ Successfully processed: ${result.successful}\r\nâ€¢ Processing failed: ${result.failed}\r\nâ€¢ Skipped files: ${result.skipped}`;  // æ·»åŠ è·³è¿‡ç»Ÿè®¡\r\n\r\n        // æ˜¾ç¤ºæˆåŠŸæ–‡ä»¶ï¼ˆåŒ…å«è¯¦ç»†ä¿¡æ¯ï¼‰\r\n        if (successFiles.length > 0) {\r\n          resultMessage += `\\n\\nâœ… Successfully processed files (${successFiles.length}):`;\r\n          successFiles.forEach((f, index) => {\r\n            resultMessage += `\\n\\n${index + 1}. ${f.main_file}`;\r\n            if (f.email_file) {\r\n              resultMessage += ` (paired with ${f.email_file})`;\r\n            }\r\n            resultMessage += `\\n   Case ID: ${f.case_id || 'N/A'}`;\r\n            resultMessage += `\\n   Status: ${f.message}`;\r\n            if (f.structured_data) {\r\n              resultMessage += `\\n   ğŸ“‹ Extracted: Date=${f.structured_data.A_date_received || 'N/A'}, Case=${f.structured_data.C_case_number || 'N/A'}, Location=${f.structured_data.H_location || 'N/A'}`;\r\n            }\r\n          });\r\n        }\r\n\r\n        // æ˜¾ç¤ºå¤±è´¥æ–‡ä»¶\r\n        if (failedFiles.length > 0) {\r\n          resultMessage += `\\n\\nâŒ Failed to process files (${failedFiles.length}):`;\r\n          failedFiles.forEach((f, index) => {\r\n            resultMessage += `\\n${index + 1}. ${f.main_file}`;\r\n            resultMessage += `\\n   Case ID: ${f.case_id || 'N/A'}`;\r\n            resultMessage += `\\n   Error: ${f.message}`;\r\n          });\r\n        }\r\n\r\n        // æ˜¾ç¤ºè·³è¿‡çš„æ–‡ä»¶ï¼ˆæ–°å¢ï¼‰\r\n        if (skippedFiles.length > 0) {\r\n          resultMessage += `\\n\\nâ­ï¸ Skipped files (${skippedFiles.length}):`;\r\n          skippedFiles.forEach((f, index) => {\r\n            resultMessage += `\\n${index + 1}. ${f.main_file}`;\r\n            resultMessage += `\\n   Case ID: ${f.case_id || 'N/A'}`;\r\n            resultMessage += `\\n   Reason: ${f.message}`;\r\n          });\r\n        }\r\n\r\n        if (successFiles.length > 0) {\r\n          resultMessage += `\\n\\nğŸ’¡ Note: The right information panel shows the last successfully processed file (${successFiles[successFiles.length - 1].main_file}).`;\r\n          resultMessage += `\\n   All ${successFiles.length} files have been processed successfully.`;\r\n          resultMessage += `\\n   You can ask questions about any of the processed cases.`;\r\n          \r\n          // è®¾ç½®æœ€åä¸€ä¸ªæˆåŠŸæ–‡ä»¶çš„æ•°æ®åˆ°å³ä¾§é¢æ¿\r\n          const lastSuccessFile = successFiles[successFiles.length - 1];\r\n          if (lastSuccessFile.structured_data) {\r\n            setChatState(prev => ({\r\n              ...prev,\r\n              extractedData: lastSuccessFile.structured_data,\r\n            }));\r\n          }\r\n        }\r\n\r\n        addMessage('bot', resultMessage);\r\n        \r\n        // Clear file list after batch processing\r\n        setSelectedFiles([]);\r\n        setIsUploadModalOpen(false);\r\n        \r\n      } catch (error) {\r\n        setChatState(prev => ({\r\n          ...prev,\r\n          isLoading: false,\r\n        }));\r\n        \r\n        addMessage('bot', `Error in batch processing files: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n        \r\n        // Clear file list on error\r\n        setSelectedFiles([]);\r\n        setIsUploadModalOpen(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Handle user queries\r\n  const handleQuery = async () => {\r\n    if (!inputMessage.trim()) return;\r\n\r\n    const userQuery = inputMessage.trim();\r\n    setInputMessage('');\r\n    addMessage('user', userQuery);\r\n\r\n    setChatState(prev => ({ ...prev, isLoading: true }));\r\n\r\n    try {\r\n      const response = await queryCase({\r\n        query: userQuery,\r\n        context: chatState.extractedData || undefined,\r\n        raw_content: chatState.rawFileContent || undefined,\r\n      });\r\n\r\n      setChatState(prev => ({ ...prev, isLoading: false }));\r\n      addMessage('bot', response);\r\n    } catch (error) {\r\n      setChatState(prev => ({ ...prev, isLoading: false }));\r\n      addMessage('bot', `Query failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    }\r\n  };\r\n\r\n  // Note: Drag and drop functionality is now handled in FileUploadModal component\r\n\r\n  // Handle keyboard events\r\n  const handleKeyPress = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleQuery();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"chatbot-container\">\r\n      {/* Single integrated chat area */}\r\n      <div className=\"chat-section-full\">\r\n        <div className=\"chat-header\">\r\n          <div className=\"header-content\">\r\n            <img src={universityLogo} alt=\"SRR Logo\" className=\"header-logo\" />\r\n            <img src={logoImage} alt=\"SRR Logo\" className=\"header-logo\" />\r\n            <div className=\"header-text\">\r\n              <h1>SRR Case Processing Assistant</h1>\r\n              <p>Intelligent File Processing & Case Query System</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"chat-body\">\r\n\r\n          {/* ä¾§è¾¹æ  */}\r\n          <div className={`sidebar-logo ${!isSidebarOpen ? 'open' : ''}`}>\r\n            <img src={sidebarbutton} alt=\"SideBar\" className=\"sidebar-button\" onClick={toggleSidebar} style={{}}/>\r\n          </div>\r\n          <div className={`sidebar-area ${isSidebarOpen ? 'open' : ''}`}>\r\n            <div className=\"sidebar-sideberheader\">\r\n              <div className=\"sidebar-userprofile\">\r\n              <img src=\"https://picsum.photos/200/200\" alt=\"Profile Picture\" className='sidebar-profilepic'/>\r\n              </div>\r\n              <div className=\"sidebar-sidebarclose\">\r\n                <img src={sidebarbutton} alt=\"SideBar\" className=\"sidebar-button\" onClick={toggleSidebar} />\r\n              </div>\r\n            </div>\r\n            <div className=\"sidebar-history\">\r\n\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"chat-inputandoutput\">\r\n            <div className=\"chat-messages\">\r\n              {chatState.messages.map((message) => (\r\n                <div key={message.id} className={`message ${message.type}`}>\r\n                  {message.type === 'bot' && (\r\n                    <div className=\"message-avatar\">\r\n                        <img src={botIcon} alt=\"Bot\" className=\"avatar-image\" />\r\n                    </div>\r\n                  )}\r\n                  <div className=\"message-content\">\r\n                    {message.fileInfo && (\r\n                      <div style={{ marginBottom: '8px', fontSize: '12px', opacity: 0.8 }}>\r\n                        <FileText size={14} style={{ display: 'inline', marginRight: '4px' }} />\r\n                        {message.fileInfo.name} ({(message.fileInfo.size / 1024).toFixed(1)} KB)\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* summary message special display */}\r\n\r\n                    <div style={{ whiteSpace: 'pre-line' }}>\r\n                      {message.content}\r\n                    </div>\r\n\r\n                  </div>\r\n                  {message.type === 'user' && (\r\n                    <div className=\"message-avatar\">\r\n                        <img src={userIcon} alt=\"User\" className=\"avatar-image\" />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              ))}\r\n              \r\n              {chatState.isLoading && (\r\n                <div className=\"message bot\">\r\n                  <div className=\"message-avatar\">\r\n                    <img src={botIcon} alt=\"Bot\" className=\"avatar-image\" />\r\n                  </div>\r\n                  <div className=\"message-content\">\r\n                    <div className=\"loading\">\r\n                      <div className=\"loading-spinner\"></div>\r\n                      Processing...\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              \r\n              <div ref={messagesEndRef} />\r\n            </div>\r\n\r\n            <div className=\"chat-input\">\r\n              <div className=\"input-container\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={inputMessage}\r\n                  onChange={(e) => setInputMessage(e.target.value)}\r\n                  onKeyPress={handleKeyPress}\r\n                  placeholder={\r\n                    chatState.isLoading \r\n                      ? \"Processing...\" \r\n                      : selectedFiles.length > 0 && !chatState.extractedData\r\n                        ? \"Click 'Process Files' to start processing or ask questions...\"\r\n                        : chatState.extractedData \r\n                          ? \"Ask questions about the case...\" \r\n                          : \"Type your message or upload files to get started...\"\r\n                  }\r\n                  disabled={chatState.isLoading}\r\n                />\r\n                \r\n                <div className=\"input-actions\">\r\n                  {/* File Upload Button */}\r\n                  <button\r\n                    className=\"action-button upload-button\"\r\n                    onClick={() => setIsUploadModalOpen(true)}\r\n                    disabled={chatState.isLoading}\r\n                    title=\"Upload files\"\r\n                  >\r\n                    <Upload size={18} />\r\n                  </button>\r\n\r\n                  {/* Process Files Button (shown when files are selected but not processed) */}\r\n                  {selectedFiles.length > 0 && !chatState.extractedData && (\r\n                    <button\r\n                      className=\"action-button process-button\"\r\n                      onClick={handleFileUpload}\r\n                      disabled={chatState.isLoading}\r\n                      title=\"Process selected files\"\r\n                    >\r\n                      {chatState.isLoading ? (\r\n                        <div className=\"loading-spinner-small\"></div>\r\n                      ) : (\r\n                        <>\r\n                          <Upload size={18} />\r\n                          Process\r\n                        </>\r\n                      )}\r\n                    </button>\r\n                  )}\r\n\r\n                  {/* View Details Button (shown when data is extracted) */}\r\n                  {chatState.extractedData && (\r\n                    <button\r\n                      className=\"action-button details-button\"\r\n                      onClick={() => setIsFileInfoModalOpen(true)}\r\n                      title=\"View file details\"\r\n                    >\r\n                      <FileText size={18} />\r\n                    </button>\r\n                  )}\r\n\r\n                  {/* Send Button */}\r\n                  <button\r\n                    className=\"action-button send-button\"\r\n                    onClick={handleQuery}\r\n                    disabled={!inputMessage.trim() || chatState.isLoading}\r\n                    title=\"Send message\"\r\n                  >\r\n                    <Send size={18} />\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* File Upload Modal */}\r\n      <FileUploadModal\r\n        isOpen={isUploadModalOpen}\r\n        onClose={() => setIsUploadModalOpen(false)}\r\n        onFilesSelected={handleFileSelection}\r\n        selectedFiles={selectedFiles}\r\n        onRemoveFile={handleRemoveFile}\r\n        onClearAll={handleClearAllFiles}\r\n        onProcessFiles={handleFileUpload}\r\n        isLoading={chatState.isLoading}\r\n      />\r\n\r\n      {/* File Info Modal */}\r\n      <FileInfoModal\r\n        isOpen={isFileInfoModalOpen}\r\n        onClose={() => setIsFileInfoModalOpen(false)}\r\n        fileInfo={chatState.currentFile}\r\n        extractedData={chatState.extractedData}\r\n        summaryResult={summaryResult}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatbotInterface;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}