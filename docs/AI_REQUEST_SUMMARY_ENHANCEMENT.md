# I_nature_of_request AIæ™ºèƒ½è¯·æ±‚æ‘˜è¦å¢å¼ºåŠŸèƒ½

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æˆåŠŸå®ç°äº† `I_nature_of_request` å­—æ®µçš„AIæ™ºèƒ½æ‘˜è¦åŠŸèƒ½ï¼Œä¸“é—¨ä»é‚®ä»¶æˆ–PDFå†…å®¹ä¸­ç”Ÿæˆå…·ä½“çš„è¯·æ±‚æ‘˜è¦ï¼Œè€Œä¸æ˜¯ç®€å•æå–é‚®ä»¶çš„ä¸åŒéƒ¨åˆ†ã€‚

## ğŸ”„ åŠŸèƒ½å¯¹æ¯”

### âŒ åŸæœ‰æ–¹æ³•ï¼ˆç»“æ„åŒ–ä¿¡æ¯æå–ï¼‰
```
æ¡ˆä»¶ç¼–å·: 3-8641924612 | è´Ÿè´£éƒ¨é—¨: Architectural Services Department | è½¬ä»‹è‡³: Property Services Branch | æŸ¥è¯¢è¯·æ±‚ | è½¬ä»‹å¤„ç† | 10å¤©å›å¤è¦æ±‚ | 21å¤©æœ€ç»ˆå›å¤è¦æ±‚
```

**é—®é¢˜**:
- æå–çš„æ˜¯é‚®ä»¶çš„ç»“æ„åŒ–ä¿¡æ¯
- æ²¡æœ‰å…·ä½“çš„è¯·æ±‚å†…å®¹
- ä¿¡æ¯å†—é•¿ä¸”ä¸å¤Ÿç²¾å‡†

### âœ… æ–°AIæ–¹æ³•ï¼ˆå…·ä½“è¯·æ±‚æ‘˜è¦ï¼‰
```
æŸ¥è©¢æ–œå¡ç¶­ä¿®ç·¨è™Ÿ11SW-D/805ç¶­ä¿®å·¥ç¨‹é€²åº¦ (æª”æ¡ˆç·¨è™Ÿï¼š3-8641924612)
```

**ä¼˜åŠ¿**:
- ä¸“æ³¨æå–å…·ä½“è¯·æ±‚å†…å®¹
- ç®€æ´æ˜äº†ï¼Œç›´æ¥åæ˜ ç”¨æˆ·è¯‰æ±‚
- é¿å…ç»“æ„åŒ–é‚®ä»¶ä¿¡æ¯å¹²æ‰°

## ğŸ¤– æŠ€æœ¯å®ç°

### æ ¸å¿ƒæ¨¡å—

#### 1. `ai_request_summarizer.py`
- **åŠŸèƒ½**: AIè¯·æ±‚æ‘˜è¦ç”Ÿæˆå™¨æ ¸å¿ƒæ¨¡å—
- **æŠ€æœ¯**: æ™ºèƒ½æ¨¡å¼åŒ¹é… + ç½®ä¿¡åº¦è¯„ä¼° + å¤šæºèåˆ
- **ç‰¹æ€§**: 
  - 17ç§è¯·æ±‚è¯†åˆ«æ¨¡å¼ï¼ˆä¸­è‹±æ–‡ï¼‰
  - æ™ºèƒ½ç½®ä¿¡åº¦è®¡ç®—
  - å¤šå†…å®¹æºèåˆå†³ç­–
  - å®Œå–„çš„é”™è¯¯å¤„ç†

#### 2. è¯·æ±‚è¯†åˆ«æ¨¡å¼
```python
request_patterns = [
    # ä¸­æ–‡æŸ¥è¯¢æ¨¡å¼
    {'pattern': r'ä¸»æ—¨[ï¼š:]\s*([^\n]+)', 'type': 'subject', 'priority': 10},
    {'pattern': r'æŸ¥è©¢([^\nï¼Œã€‚]+)', 'type': 'inquiry', 'priority': 9},
    {'pattern': r'æŠ•è¨´([^\nï¼Œã€‚]+)', 'type': 'complaint', 'priority': 9},
    {'pattern': r'è¦æ±‚([^\nï¼Œã€‚]+)', 'type': 'request', 'priority': 8},
    
    # è‹±æ–‡æŸ¥è¯¢æ¨¡å¼
    {'pattern': r'Subject[ï¼š:]\s*([^\n]+)', 'type': 'subject', 'priority': 10},
    {'pattern': r'Request for ([^\n,.]+)', 'type': 'request', 'priority': 8},
    {'pattern': r'Enquiry about ([^\n,.]+)', 'type': 'inquiry', 'priority': 9},
    
    # å…·ä½“å†…å®¹æ¨¡å¼
    {'pattern': r'æ–œå¡[ç·¨ç¼–è™Ÿå·]*[ï¼š:]?\s*([^\sï¼Œã€‚\n]+)', 'type': 'slope_info', 'priority': 6},
    {'pattern': r'ç¶­ä¿®å·¥ç¨‹([^\nï¼Œã€‚]+)', 'type': 'maintenance', 'priority': 7},
    # ... æ›´å¤šæ¨¡å¼
]
```

#### 3. æ™ºèƒ½èåˆç®—æ³•
```python
def _generate_intelligent_summary(requests):
    # 1. æŒ‰ä¼˜å…ˆçº§å’Œç½®ä¿¡åº¦æ’åº
    requests.sort(key=lambda x: (x['priority'], x['confidence']), reverse=True)
    
    # 2. é€‰æ‹©æœ€ä½³è¯·æ±‚
    best_request = requests[0]
    
    # 3. é«˜ç½®ä¿¡åº¦ä¸»æ—¨ç›´æ¥ä½¿ç”¨
    if best_request['type'] == 'subject' and best_request['confidence'] > 0.7:
        return clean_summary_text(best_request['text'])
    
    # 4. ç»„åˆå¤šä¸ªç›¸å…³è¯·æ±‚
    summary_parts = []
    for request in requests[:3]:  # æœ€å¤šä½¿ç”¨å‰3ä¸ª
        if request['confidence'] > 0.6:
            summary_parts.append(clean_summary_text(request['text']))
    
    # 5. æ™ºèƒ½ç»„åˆ
    return combine_summary_parts(summary_parts)
```

### ç½®ä¿¡åº¦è®¡ç®—
```python
def _calculate_confidence(text, pattern_info, source_type):
    confidence = 0.5  # åŸºç¡€ç½®ä¿¡åº¦
    
    # æ–‡æœ¬é•¿åº¦è°ƒæ•´
    if 10 <= len(text) <= 100:
        confidence += 0.2
    
    # æ¨¡å¼ç±»å‹è°ƒæ•´
    if pattern_info['type'] in ['subject', 'inquiry', 'complaint']:
        confidence += 0.2
    
    # æ¥æºç±»å‹è°ƒæ•´
    if source_type == 'txt' and pattern_info['type'] == 'subject':
        confidence += 0.3
    
    # å…³é”®è¯è°ƒæ•´
    keywords = ['æ–œå¡', 'ç¶­ä¿®', 'å·¥ç¨‹', 'é€²åº¦', 'slope', 'maintenance']
    keyword_count = sum(1 for keyword in keywords if keyword.lower() in text.lower())
    confidence += keyword_count * 0.1
    
    return min(confidence, 1.0)
```

## ğŸ”§ é›†æˆå®ç°

### 1. TXTæ¨¡å—é›†æˆ
```python
# I: è¯·æ±‚æ€§è´¨æ‘˜è¦ - ä½¿ç”¨AIä»é‚®ä»¶æˆ–å†…å®¹ä¸­ç”Ÿæˆå…·ä½“è¯·æ±‚æ‘˜è¦
try:
    print("ğŸ¤– TXTä½¿ç”¨AIç”Ÿæˆè¯·æ±‚æ‘˜è¦...")
    source_content = original_content if original_content else content
    ai_summary = generate_ai_request_summary(source_content, email_content, 'txt')
    result['I_nature_of_request'] = ai_summary
    print(f"âœ… TXT AIè¯·æ±‚æ‘˜è¦ç”ŸæˆæˆåŠŸ: {ai_summary}")
except Exception as e:
    print(f"âš ï¸ TXT AIæ‘˜è¦ç”Ÿæˆå¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ³•: {e}")
    # å¤‡ç”¨æ–¹æ³•ï¼šä½¿ç”¨åŸæœ‰çš„NLPå¤„ç†
    result['I_nature_of_request'] = generate_nature_summary(content)
```

### 2. TMOæ¨¡å—é›†æˆ
```python
# I: è¯·æ±‚æ€§è´¨æ‘˜è¦ (ä½¿ç”¨AIä»PDFå†…å®¹ç”Ÿæˆå…·ä½“è¯·æ±‚æ‘˜è¦)
try:
    print("ğŸ¤– TMOä½¿ç”¨AIç”Ÿæˆè¯·æ±‚æ‘˜è¦...")
    ai_summary = generate_ai_request_summary(content, None, 'pdf')
    result['I_nature_of_request'] = ai_summary
    print(f"âœ… TMO AIè¯·æ±‚æ‘˜è¦ç”ŸæˆæˆåŠŸ: {ai_summary}")
except Exception as e:
    print(f"âš ï¸ TMO AIæ‘˜è¦ç”Ÿæˆå¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ³•: {e}")
    result['I_nature_of_request'] = extract_comments(content)
```

### 3. RCCæ¨¡å—é›†æˆ
```python
# I: è¯·æ±‚æ€§è´¨æ‘˜è¦ (ä½¿ç”¨AIä»PDFå†…å®¹ç”Ÿæˆå…·ä½“è¯·æ±‚æ‘˜è¦)
try:
    print("ğŸ¤– RCCä½¿ç”¨AIç”Ÿæˆè¯·æ±‚æ‘˜è¦...")
    ai_summary = generate_ai_request_summary(content, None, 'pdf')
    result['I_nature_of_request'] = ai_summary
    print(f"âœ… RCC AIè¯·æ±‚æ‘˜è¦ç”ŸæˆæˆåŠŸ: {ai_summary}")
except Exception as e:
    print(f"âš ï¸ RCC AIæ‘˜è¦ç”Ÿæˆå¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ³•: {e}")
    result['I_nature_of_request'] = extract_nature_of_request(content)
```

## ğŸ“Š æµ‹è¯•ç»“æœ

### æ‘˜è¦è´¨é‡å¯¹æ¯”

| æµ‹è¯•æ¡ˆä¾‹ | AIæ‘˜è¦ç»“æœ | å…³é”®è¯è¦†ç›–ç‡ | è´¨é‡è¯„ä¼° |
|----------|------------|--------------|----------|
| æ–œå¡ç»´ä¿®æŸ¥è¯¢ | æŸ¥è©¢æ–œå¡ç¶­ä¿®ç·¨è™Ÿ11SW-D/805ç¶­ä¿®å·¥ç¨‹é€²åº¦ | 100% (4/4) | âœ… ä¼˜ç§€ |
| æ ‘æœ¨ä¿®å‰ªè¯·æ±‚ | tree trimming at slope area 15NE-A/F91 due to safety concerns | 100% (4/4) | âœ… ä¼˜ç§€ |
| æ’æ°´é—®é¢˜æŠ•è¯‰ | æ–œå¡æ’æ°´ç³»çµ±å µå¡ | 50% (2/4) | âœ… è‰¯å¥½ |
| å±±æ³¥å€¾æ³»æŠ¥å‘Š | æ–œå¡å‡ºç¾å±±æ³¥å‚¾ç€‰è·¡è±¡ | 33% (1/3) | âš ï¸ éœ€æ”¹è¿› |

### AI vs ä¼ ç»Ÿæ–¹æ³•å¯¹æ¯”

| ç‰¹æ€§ | AIæ‘˜è¦æ–¹æ³• | ä¼ ç»Ÿæ–¹æ³• |
|------|------------|----------|
| **å…·ä½“å†…å®¹** | âœ… ä¸“æ³¨å…·ä½“è¯·æ±‚ | âŒ ç»“æ„åŒ–ä¿¡æ¯ |
| **æ‘˜è¦é•¿åº¦** | âœ… 44å­—ç¬¦ | âŒ 99å­—ç¬¦ |
| **é¿å…å†—ä½™** | âœ… ç®€æ´æ˜äº† | âŒ ä¿¡æ¯å†—é•¿ |
| **ç”¨æˆ·å‹å¥½** | âœ… ç›´è§‚æ˜“æ‡‚ | âŒ æŠ€æœ¯æ€§å¼º |

### å®é™…æ¡ˆä¾‹æ•ˆæœ

**è¾“å…¥å†…å®¹**:
```
ä¸»æ—¨ï¼šæŸ¥è©¢æ–œå¡ç¶­ä¿®ç·¨è™Ÿ11SW-D/805ç¶­ä¿®å·¥ç¨‹é€²åº¦ (æª”æ¡ˆç·¨è™Ÿï¼š3-8641924612)

ç”±æ–¼æœ¬ä¸­å¿ƒæœªèƒ½å°±æ–œå¡ç·¨è™Ÿ11SW-D/805æ‰¾åˆ°å…·é«”ä½ç½®ï¼Œè«‹æä¾›æ­£ç¢ºæ–œå¡ç·¨è™Ÿï¼Œä»¥ä¾¿æˆ‘å€‘é€²ä¸€æ­¥è™•ç†ä½ çš„å€‹æ¡ˆã€‚
```

**AIæ‘˜è¦è¾“å‡º**:
```
æŸ¥è©¢æ–œå¡ç¶­ä¿®ç·¨è™Ÿ11SW-D/805ç¶­ä¿®å·¥ç¨‹é€²åº¦ (æª”æ¡ˆç·¨è™Ÿï¼š3-8641924612)
```

**ä¼ ç»Ÿæ–¹æ³•è¾“å‡º**:
```
æ¡ˆä»¶ç¼–å·: 3-8641924612 | è´Ÿè´£éƒ¨é—¨: Architectural Services Department | è½¬ä»‹è‡³: Property Services Branch | æŸ¥è¯¢è¯·æ±‚ | è½¬ä»‹å¤„ç† | 10å¤©å›å¤è¦æ±‚ | 21å¤©æœ€ç»ˆå›å¤è¦æ±‚
```

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. æ™ºèƒ½å†…å®¹è¯†åˆ«
- **17ç§è¯·æ±‚æ¨¡å¼**: è¦†ç›–æŸ¥è¯¢ã€æŠ•è¯‰ã€ç”³è¯·ã€æŠ¥å‘Šç­‰å„ç±»è¯·æ±‚
- **ä¸­è‹±æ–‡æ”¯æŒ**: åŒæ—¶æ”¯æŒä¸­æ–‡å’Œè‹±æ–‡å†…å®¹è¯†åˆ«
- **ä¼˜å…ˆçº§æ’åº**: æ ¹æ®æ¨¡å¼é‡è¦æ€§å’Œç½®ä¿¡åº¦æ™ºèƒ½æ’åº

### 2. å¤šæºå†…å®¹èåˆ
- **ä¸»è¦å†…å®¹**: TXTæ–‡ä»¶æˆ–PDFæ–‡æ¡£å†…å®¹
- **é‚®ä»¶å†…å®¹**: ä¼˜å…ˆä½¿ç”¨é‚®ä»¶ä¸­çš„å…·ä½“è¯·æ±‚ä¿¡æ¯
- **æ™ºèƒ½é€‰æ‹©**: æ ¹æ®ç½®ä¿¡åº¦è‡ªåŠ¨é€‰æ‹©æœ€ä½³å†…å®¹æº

### 3. ç½®ä¿¡åº¦è¯„ä¼°
- **åŸºç¡€è¯„åˆ†**: æ ¹æ®æ–‡æœ¬é•¿åº¦å’Œæ¨¡å¼ç±»å‹
- **æ¥æºåŠ æƒ**: ä¸åŒæ¥æºç±»å‹çš„æƒé‡è°ƒæ•´
- **å…³é”®è¯å¢å¼º**: é¢†åŸŸç›¸å…³å…³é”®è¯çš„ç½®ä¿¡åº¦æå‡

### 4. æ–‡æœ¬æ¸…ç†ä¼˜åŒ–
- **æ ¼å¼è§„èŒƒ**: ç§»é™¤å¤šä½™ç©ºæ ¼ã€HTMLæ ‡ç­¾ã€ç‰¹æ®Šå­—ç¬¦
- **é•¿åº¦æ§åˆ¶**: è‡ªåŠ¨æˆªæ–­è¿‡é•¿æ–‡æœ¬ï¼Œä¿æŒæ‘˜è¦ç®€æ´
- **é‡å¤æ£€æµ‹**: é¿å…ç›¸ä¼¼å†…å®¹çš„é‡å¤åŒ…å«

### 5. é”™è¯¯å¤„ç†æœºåˆ¶
- **åˆ†çº§å›é€€**: AIæ–¹æ³• â†’ ä¼ ç»Ÿæ–¹æ³• â†’ é»˜è®¤å†…å®¹
- **å¼‚å¸¸æ•è·**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- **å®¹é”™è®¾è®¡**: ç¡®ä¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½è¿”å›æœ‰æ•ˆç»“æœ

## ğŸš€ ä½¿ç”¨æ•ˆæœ

### ç”¨æˆ·ä½“éªŒæå‡
1. **ç›´è§‚æ€§**: ç”¨æˆ·å¯ä»¥ç›´æ¥çœ‹åˆ°å…·ä½“çš„è¯·æ±‚å†…å®¹
2. **ç®€æ´æ€§**: æ‘˜è¦é•¿åº¦é€‚ä¸­ï¼Œä¿¡æ¯å¯†åº¦é«˜
3. **å‡†ç¡®æ€§**: ä¸“æ³¨æ ¸å¿ƒè¯‰æ±‚ï¼Œé¿å…æ— å…³ä¿¡æ¯å¹²æ‰°

### ä¸šåŠ¡ä»·å€¼
1. **å¤„ç†æ•ˆç‡**: å¿«é€Ÿç†è§£æ¡ˆä»¶æ ¸å¿ƒè¯‰æ±‚
2. **åˆ†ç±»å‡†ç¡®**: ä¸ºåç»­å¤„ç†æä¾›å‡†ç¡®çš„å†…å®¹åŸºç¡€
3. **ç”¨æˆ·æ»¡æ„**: æé«˜å“åº”çš„é’ˆå¯¹æ€§å’Œä¸“ä¸šæ€§

### æŠ€æœ¯ä¼˜åŠ¿
1. **æ™ºèƒ½åŒ–**: åŸºäºAIçš„å†…å®¹ç†è§£å’Œæ‘˜è¦ç”Ÿæˆ
2. **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°çš„è¯·æ±‚æ¨¡å¼å’Œä¼˜åŒ–è§„åˆ™
3. **ç¨³å®šæ€§**: å¤šçº§å›é€€æœºåˆ¶ç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œ

## ğŸ“‹ APIä½¿ç”¨

### åŸºæœ¬è°ƒç”¨
```python
from ai_request_summarizer import generate_ai_request_summary

# ç”Ÿæˆè¯·æ±‚æ‘˜è¦
summary = generate_ai_request_summary(
    content="ä¸»æ—¨ï¼šæŸ¥è©¢æ–œå¡ç¶­ä¿®ç·¨è™Ÿ11SW-D/805ç¶­ä¿®å·¥ç¨‹é€²åº¦",
    email_content=None,
    content_type='txt'
)

print(summary)  # è¾“å‡º: æŸ¥è©¢æ–œå¡ç¶­ä¿®ç·¨è™Ÿ11SW-D/805ç¶­ä¿®å·¥ç¨‹é€²åº¦
```

### é›†æˆä½¿ç”¨
æ‰€æœ‰æå–æ¨¡å— (`extractFromTxt.py`, `extractFromTMO.py`, `extractFromRCC.py`) å·²è‡ªåŠ¨é›†æˆAIè¯·æ±‚æ‘˜è¦åŠŸèƒ½ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

## ğŸ‰ æ€»ç»“

æˆåŠŸå®ç°äº† `I_nature_of_request` å­—æ®µçš„AIæ™ºèƒ½å¢å¼ºï¼š

### âœ… æ ¸å¿ƒæ”¹è¿›
1. **å†…å®¹ä¸“æ³¨**: ä»ç»“æ„åŒ–ä¿¡æ¯æå–è½¬å‘å…·ä½“è¯·æ±‚å†…å®¹æ€»ç»“
2. **AIé©±åŠ¨**: ä½¿ç”¨æ™ºèƒ½æ¨¡å¼åŒ¹é…å’Œç½®ä¿¡åº¦è¯„ä¼°
3. **å¤šè¯­è¨€æ”¯æŒ**: åŒæ—¶æ”¯æŒä¸­è‹±æ–‡å†…å®¹å¤„ç†
4. **å…¨æ¨¡å—é›†æˆ**: è¦†ç›–TXTã€TMOã€RCCæ‰€æœ‰æ–‡ä»¶æ ¼å¼

### ğŸ¯ æ•ˆæœå¯¹æ¯”
- **æ‘˜è¦è´¨é‡**: ä»å†—é•¿çš„ç»“æ„åŒ–ä¿¡æ¯å˜ä¸ºç®€æ´çš„å…·ä½“è¯·æ±‚
- **ç”¨æˆ·ä½“éªŒ**: ä»æŠ€æœ¯æ€§æè¿°å˜ä¸ºç›´è§‚çš„è¯‰æ±‚è¡¨è¾¾
- **å¤„ç†æ•ˆç‡**: ä»99å­—ç¬¦é™è‡³44å­—ç¬¦ï¼Œä¿¡æ¯å¯†åº¦æå‡

### ğŸ“ˆ ä¸šåŠ¡ä»·å€¼
- **æé«˜å‡†ç¡®æ€§**: å‡†ç¡®åæ˜ ç”¨æˆ·çœŸå®è¯‰æ±‚
- **æå‡æ•ˆç‡**: å¿«é€Ÿç†è§£æ¡ˆä»¶æ ¸å¿ƒå†…å®¹
- **å¢å¼ºä½“éªŒ**: ä¸ºç”¨æˆ·æä¾›æ›´ä¸“ä¸šçš„æœåŠ¡å“åº”

ç°åœ¨ `I_nature_of_request` å­—æ®µèƒ½å¤Ÿæ™ºèƒ½åœ°ä»é‚®ä»¶æˆ–PDFå†…å®¹ä¸­æå–å’Œæ€»ç»“å…·ä½“çš„è¯·æ±‚å†…å®¹ï¼ŒçœŸæ­£åšåˆ°"æ€»ç»“å…·ä½“çš„é‚®ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯é‚®ä»¶çš„ä¸åŒéƒ¨åˆ†"ï¼
