# SRR项目LLM+RAG核心功能开发分工安排
两位兄弟：

为实现 **上下文记忆（跨模型）、会话+用户管理、固定流程交互、文件上传向量化入库** 4大功能并行开发，确保模块解耦无强依赖、工作量均衡、进度基本同步，现将具体分工及要求安排如下：

## 一、 前置核心要求：统一公共约定
这是独立开发的前提，避免后续集成出现格式不兼容问题。前置核心要求示例：
| 公共项                | 约定详情（示例）                                                                 |
|-----------------------|----------------------------------------------------------------------------------|
| 核心唯一标识（ID）    | 用户ID（`user_id: str`，如`uuid4()`生成）、会话ID（`session_id: str`）、文件ID（`file_id: str`）、流程ID（`process_id: str`） |
| 标准化返回格式        | 所有模块对外输出统一结构：`{"code": int, "msg": str, "data": dict, "success": bool}` |
| 上下文数据格式        | 跨模型上下文统一为：`{"user_id": str, "session_id": str, "context_content": str, "context_time": datetime, "model_type": str}` |
| 流程状态枚举          | 固定流程的4个状态：`PENDING（预设问题待发送）`、`WAIT_USER_SUPPLEMENT（待用户补充）`、`GENERATING_DRAFT（生成草稿中）`、`DRAFT_COMPLETE（草稿完成）` |
| 向量库公共配置        | 统一向量库类型（Surrealdb）、Embedding模型（nomic-embed-text Embedding模型） |

3人协同参与讨论确认，维护一份《公共接口与数据结构文档》，后续所有开发均遵循该文档，**仅依赖文档约定的格式即可独立开发**。


## 二、 人员分工明细（3人并行开发，无强依赖）

### 張威健：负责「上下文记忆（跨模型）」（功能1）+ 功能3 
#### 核心职责（聚焦“跨模型上下文的存储与提取”，无强依赖）
1.  实现跨模型上下文的**标准化处理**：无论调用哪种LLM（通义千和GPT），都将上下文转换为前置约定的统一数据格式，消除模型间格式差异。
2.  实现上下文的**CRUD操作**：存储（关联`user_id`和`session_id`）、提取（按会话/用户查询历史上下文）、更新（追加新的会话内容）、清理（过期上下文自动删除）。
3.  实现跨模型上下文的**优化逻辑**：上下文压缩（避免冗余内容超出LLM上下文窗口）、关键信息提取（保留核心对话内容）、上下文优先级排序（近期内容权重更高）。
4.  对外提供**独立接口**：`save_context()`、`get_context_by_session()`、`update_context()`、`delete_expired_context()`，返回格式符合公共约定。

#### 交付物与边界
- 交付物：上下文记忆模块的独立代码包、单元测试用例（用模拟`user_id`/`session_id`测试，无需依赖真实用户/会话模块）、接口文档。
- 边界：不关心用户/会话的具体实现，仅接收符合约定格式的`user_id`/`session_id`；不关心LLM的具体调用，仅处理上下文数据。

#### 预估进度
和其他两人保持一致，分为3个小阶段：① 数据层实现（？天）→ ② 业务逻辑与优化（？天）→ ③ 自测与接口完善（？天）。


---

### 侯昊辰：负责「会话功能+用户管理」（功能2）+「更新流程-状态管理」（功能3子模块）
#### 核心职责（聚焦“业务底座与流程状态流转”，无强依赖，工作量中等）
该分配将“用户/会话”（偏CURD）和“流程状态管理”（偏状态存储）合并。

1.  用户管理功能：实现用户的CRUD（（优先：注册、登录、注销）、查询用户信息、修改密码、删除用户），支持用户身份验证（如token验证）。
2.  会话功能：实现会话的CRUD（创建会话、查询用户所有会话、查询会话详情、关闭会话、删除会话），关联`user_id`，确保会话与用户一一对应。
3.  更新流程-状态管理：实现固定流程的状态存储与流转，记录每个`process_id`对应的状态（符合公共约定的枚举值）、关联`user_id`/`session_id`、记录各状态的切换时间。
4. 笔记
5.  对外提供**独立接口**：
    - 用户模块：`user_register()`、`user_login()`、`get_user_info()`。
    - 会话模块：`create_session()`、`get_user_sessions()`、`get_session_detail()`。
    - 流程状态模块：`update_process_status()`、`get_process_status()`。
    所有接口返回格式符合公共约定。

#### 交付物与边界
- 交付物：用户/会话/流程状态模块的独立代码包、单元测试用例（用模拟数据测试，无需依赖上下文/文件模块）、接口文档。
- 边界：不关心上下文的具体内容，仅存储/返回`session_id`；不关心LLM生成与文件入库，仅管理流程状态的切换，不处理具体的AI回复逻辑。

#### 预估进度
和其他两人同步，3个小阶段：① 用户/会话数据层实现（？天）→ ② 流程状态管理+业务逻辑（？天）→ ③ 自测与接口完善（？天）。


---

### 羅凱榮：负责「文件上传并向量化后入库功能」（功能4）+「更新流程-草稿生成辅助」（功能3子模块）
#### 核心职责（聚焦“文件处理与向量库交互”，完全独立，工作量中等）
该分配将“文件上传向量化”（偏工具链集成）和“流程中的文件关联”（辅助草稿生成）合并。

1.  文件上传功能：支持多格式文件上传（PDF/Word/TXT等）、文件合法性校验（大小、格式）、文件存储（本地/对象存储）、生成唯一`file_id`。
2.  文件向量化与入库：实现文件内容解析（提取文本）、语义分块（遵循公共约定的分块规则）、向量化（调用统一Embedding模型）、向量数据入库（Surrealdb），关联`file_id`/`user_id`，支持按`file_id`查询向量数据。
3.  更新流程-草稿生成辅助：提供“文件向量数据检索接口”，供后续Draft生成时调用（根据用户补充资料，检索对应的文件向量内容），无需处理Draft生成逻辑，仅提供数据支撑。

4. 进一步增强：
4.1 结构化数据库优化（eg.去重校验）
4.2 结构化数据库与向量数据库的联动
4.3 结构化数据库与向量数据库的数据输入来源及元数据设计

5.  对外提供**独立接口**：`file_upload()`、`file_parse_and_vectorize()`、`get_vector_by_file_id()`、`get_vector_by_query()`，返回格式符合公共约定。

#### 交付物与边界
- 交付物：文件上传向量化模块的独立代码包、单元测试用例（用本地测试文件测试，无需依赖其他任何模块）、接口文档。
- 边界：不关心用户/会话/上下文的具体实现，仅接收符合约定格式的`user_id`；不关心LLM的具体调用，仅提供向量化数据和检索结果。

#### 预估进度
和其他两人同步，3个小阶段：① 文件上传与解析（？天）→ ② 向量化与向量库入库（？天）→ ③ 检索接口+自测（？天）。

---

## 三、 功能3 更新流程（按（選擇）預設問題-->AI 回覆詢問(是否有補充資料/調查結果)--> 使用者回應--> AI 回覆draft reply）的集成逻辑
完整流程（预设问题→AI询补充→用户回应→AI生成Draft）通过「**模块接口对接**」实现，开发阶段各模块独立，集成阶段仅需调用对方的接口，具体逻辑：
1.  预设问题：**侯昊辰**（用户会话流程状态）初始化流程状态为`PENDING`，调用**張威健**（上下文）的接口获取历史上下文，传入LLM发送预设问题。
2.  AI询补充：LLM生成补充询问后，**侯昊辰**将流程状态更新为`WAIT_USER_SUPPLEMENT`，等待用户回应。
3.  用户回应：用户提交补充资料/调查结果后，**羅凱榮**（文件模块）提供向量检索结果（如有文件上传），**张威健**将用户回应追加到上下文。
4.  AI生成Draft：**张威健**调用LLM，传入上下文+文件检索结果，生成Draft，**侯昊辰**将流程状态更新为`DRAFT_COMPLETE`。

该集成逻辑在**所有模块独立开发完成后**进行（？天），无需在并行开发阶段互相依赖，不影响各自进度。

## 四、 进度同步保障措施
1.  **统一里程碑**：每3天過一次
4.  **独立自测**：不依赖其他模块真实代码，用模拟数据完成闭环测试。

## 五、 集成阶段安排（所有模块完成后，1-2天）
3人协同完成，核心是调用各模块的对外接口，实现功能串联，具体步骤：
1.  对接用户/会话模块与上下文模块：用`user_id`/`session_id`关联，实现“查询用户会话→获取对应上下文”。
2.  对接文件模块与流程模块：用`file_id`关联，实现“用户上传文件→向量化入库→Draft生成时检索文件向量”。
3.  对接所有模块与LLM：实现完整的更新流程，测试端到端功能是否正常。
4.  统一测试与bug修复：针对集成后的问题，由对应模块的开发者负责修复，不影响其他模块。

---


各位有问题及时在群内沟通，确保项目高效推进！















